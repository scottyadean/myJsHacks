<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=yes" />
    <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      .pointer {
        
        cursor: pointer;
        
      }
      
      #map-canvas { height: 100% }
      .info-canvas{
        
            background-color: #f6f6f6;
            min-height: 100px;
            max-height: 200px;
            overflow: auto;
            width: 100%;
            padding: 50px;
            position: absolute;
            left: 0px;
            bottom: 0px;
            z-index: 1001;
        
        }
    </style>
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDLH9g4xG6aB3qiAHyyJXyJXsRGhv0wBnw&sensor=true&region=us"> </script>
    
  </head>
  <body>
    <div id="info-canvas" class="info-canvas">
        <a class="pointer" onclick="CheckIn.Geo()">Current Postion</a> |
        
        
        Start:<span id="info-canvas-address"
            class="pointer js-click-to-update"
            field:type="text"
            field:name="js-current-value"
            field:value=""
            field:length="255"></span>
        
        <br />
        <a class="pointer" onclick="CheckIn.End()">Drop Pin</a> |
        End:<span id="info-canvas-end"
            class="pointer js-click-to-update"
            field:type="text"
            field:name="js-current-end"
            field:value=""
            field:length="255"></span>
    </div>
    <div id="map-canvas" > </div>
    
    
    
    
    
    <script type="text/javascript">
            
    
      
      var CheckIn = {
            
            Map:null,
            Geocoder:null,
            Marker:null,
            EndMaker:null,
            Coords:{ lat:0, lng:0 ,
                    start:{ lat:0, lng:0 },
                    destination:{ lat:0, lng:0  },
                    address:{ el:null, start:null, end:null }, },
            
            Init:function(){
                
                var mapOptions = {
                    center: new google.maps.LatLng(38.72993436850347, -120.80449479198455),
                    zoom: 14,
                    mapTypeId: google.maps.MapTypeId.ROADMAP
                };
                
                CheckIn.Coords.address.el = 'info-canvas-address';
                CheckIn.Map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);
                
                
                var myLatlng = new google.maps.LatLng(38.72993436850347, -120.80449479198455);
                
                CheckIn.Marker = new google.maps.Marker({
                    position: myLatlng,
                    title:"Drag me to your Check-in ",
                    draggable:true,
                    animation: google.maps.Animation.DROP
                });
                
                CheckIn.Marker.setMap( CheckIn.Map );
                google.maps.event.addListener(CheckIn.Marker, 'dragend', CheckIn.Drag);
                
               
                $('body').delegate(".js-click-to-update", "click", function(){
                    
                        
                        var el = $(this);
                        
                        if ( $("#"+el.attr('id')+" #js-current-value-update-btn").size() != 0 ) {
                            return false;
                        }
                    
                        
                        CheckIn.Coords.address.el = el.attr('id');
                        
                        var field = { type: el.attr("field:type"),
                                      name: el.attr("field:name"),
                                      id: el.attr("field:name"),
                                      maxlength: el.attr("field:length"),
                                      value: el.attr("field:value"),
                                      width:300
                                    };
                        
                        var btn = {
                                    id:"js-current-value-update-btn",
                                    value:"update",
                                    type:"button",
                                    class:"pointer",
                                 };
                        
                        el.html( $('<input/>', field) );
                        el.append($('<input/>', btn));
                        
                        return true;         
                    
                    });
                
                
                    $('body').delegate("#js-current-value-update-btn", "click", function(){
                    
                        CheckIn.LatLng();
                    
                    }); 
               

                
            },
            
            Geo:function() {
                
                if (navigator.geolocation) {
                 
                    navigator.geolocation.getCurrentPosition(CheckIn.MoveTo);
                
                } else {
                
                    $("#info-canvas").html("Geolocation is not supported by this browser.");
                
                }
            },
            
            Drag:function(data){                
               
                CheckIn.MoveTo({coords:{ latitude:data.latLng.lb, longitude:data.latLng.mb  }});
                
                
                
            },
           MoveTo:function(position, noAddress) {
            
               var latlng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
               CheckIn.moveMarker(latlng);
               CheckIn.Map.panTo(latlng);
               CheckIn.Map.setZoom(14);

               CheckIn.Geocoder = new google.maps.Geocoder();
               
               if (noAddress == undefined || noAddress == false) {
                    CheckIn.Geocoder.geocode({'latLng': latlng}, CheckIn.Address);
               }
               

           },
        

            
            
            moveMarker:function(latlng) {
                
            
                CheckIn.Marker.setPosition(latlng);
                
                
            },
            
            LatLng:function(){
                
                
                var address = $("#js-current-value").val();
    
                CheckIn.Geocoder = new google.maps.Geocoder();
                CheckIn.Geocoder.geocode({'address': address}, CheckIn.OnLatLng);
                
                
            },
            
            OnLatLng:function(data){
                
                
                if (data[0]) {
                    
                   
                    var address = data[0].formatted_address;
                    var el = $("#info-canvas-address");
                        el.attr("field:value", address);
                        el.html(address);
                
                    var laglng = data[0].geometry.location;
                    CheckIn.MoveTo({coords:{ latitude:laglng.lb, longitude:laglng.mb  }}, true);
                    
                }
                
                
            },
            
            
            End:function(){
                
              var lat = '38.72993436850347';
              var lng = '-120.80449479198455';
              var myLatlng = new google.maps.LatLng(lat, lng);
                
                CheckIn.EndMaker = new google.maps.Marker({
                    position: myLatlng,
                    title:"Drag Me To Destination",
                    draggable:true,
                    icon:'http://maps.google.com/mapfiles/ms/icons/blue-dot.png',
                    animation: google.maps.Animation.DROP
                });
                
                CheckIn.Coords.destination.lat = lat;
                CheckIn.Coords.destination.lng = lng;
                CheckIn.Coords.address.el = 'info-canvas-end';
                CheckIn.EndMaker.setMap( CheckIn.Map );
                
                google.maps.event.addListener(CheckIn.EndMaker, 'dragend', CheckIn.Drag);
            },
            
            
            Address:function(results, status) {
                
                if (status == google.maps.GeocoderStatus.OK) {
                    if (results[1]) {
                      var ad = results[0].formatted_address;
                      var el = $("#"+CheckIn.Coords.address.el);
                          el.html("Approximate: " + ad);
                          el.attr("field:value", ad);
                    }
                }
            }
            
      };
      
      google.maps.event.addDomListener(window, 'load', CheckIn.Init);
      
    </script>
    
    
    
    
  </body>
</html>